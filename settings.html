<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, update, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC7omObD0cWgdqGsNq-8L7n9i_Akp_JCEM",
        authDomain: "master-web-app-d8d1b.firebaseapp.com",
        projectId: "master-web-app-d8d1b",
        databaseURL: "https://master-web-app-d8d1b-default-rtdb.firebaseio.com",
        appId: "1:460731698074:web:40ad4f12c5fb3126874823"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    window.saveSet = async () => {
        const dFileInput = document.getElementById('dImgFile');
        const tFileInput = document.getElementById('titleImgFile');
        
        // Create an update object with ONLY the fields that have values
        const updates = {};
        
        const title = document.getElementById('title').value;
        const phone = document.getElementById('phone').value;
        const dName = document.getElementById('dName').value;
        const tNo = document.getElementById('tNo').value;
        const tModel = document.getElementById('tModel').value;
        const tCap = document.getElementById('tCap').value;

        if(title) updates.title = title;
        if(phone) updates.phone = phone;
        if(dName) updates.driverName = dName;
        if(tNo) updates.taxiNo = tNo;
        if(tModel) updates.taxiModel = tModel;
        if(tCap) updates.capacity = tCap;

        // Only add images if a new file was selected
        if (dFileInput.files.length > 0) {
            updates.driverImg = await toBase64(dFileInput.files[0]);
        }
        if (tFileInput.files.length > 0) {
            updates.titleImg = await toBase64(tFileInput.files[0]);
        }

        // Use 'update' instead of 'set' to keep existing data safe
        update(ref(db, 'settings'), updates)
            .then(() => alert("✅ Settings Updated Successfully!"))
            .catch((err) => alert("❌ Error: " + err.message));
    };

    // ... (rest of the addPkg and delPkg functions remain the same)
</script>
